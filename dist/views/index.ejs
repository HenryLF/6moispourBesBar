<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>6 mois pour BESBAR</title>
    <script id="iframe-api" src="https://www.youtube.com/iframe_api"></script>
    <link rel="stylesheet" href="/style.css" />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.9/dist/cdn.min.js"
    ></script>
  </head>
  <body
    x-data="{index:0,
        n : <%=videos.length%>,
        touchEvent : null,
        incrementIndex(x){
          if(this.index + x < 0 || this.index + x > this.n ) return
          this.index +=x
        }
      }"
    @scroll.window="$event.deltaY > 100 ? incrementIndex(1) :  $event.deltaY < -100 && incrementIndex(-1)"
    @touchstart.window="touchEvent = {y: $event.clientX,x: $event.clientY}"
    @touchend.window="console.log(touchEvent)"
    @keyup.window="['ArrowUp' , 'ArrowRight'].includes($event.key) && incrementIndex(1) ;
      ['ArrowDown' , 'ArrowLeft'].includes($event.key) && incrementIndex(-1) ;"
  >
    <header
      class="w-full motion"
      @mouseover="hidden=false"
      @mouseleave="hidden=true"
      x-data="{hidden : false}"
      x-init="setTimeout(()=>hidden=true , 1_000)"
      :text="touchEvent"
    >
      <section
        class="size-full motion"
        x-bind:class="hidden ? '-translate-y-full' : ''"
      >
        <h1>6 mois pour BESBAR</h1>
      </section>
    </header>
    <div class="flex-col flex-1 w-full" @click="incrementIndex(-1)"></div>
    <div class="grid grid-cols-15 w-full">
      <aside class="col-span-1 size-full" @click="incrementIndex(-1)"></aside>
      <section class="w-full col-span-13 aspect-video">
        <% videos.forEach((video , id) => { %>
        <template x-if="Math.abs(<%=id%> - index)<2">
          <div
            class="size-full"
            x-data="{show : index == <%=id%>}"
            x-effect="show = index == <%=id%>; Math.abs(<%=id%> - index)>2 && console.log('out')  "
            x-show="show"
            x-transition:enter="transition duration-500 ease-in"
            x-transition:enter-start="scale-95 opacity-0"
            x-transition:enter-end="opacity-100 scale-100"
          >
            <div
              x-init="setTimeout(()=>initPlayer($el,'<%=video%>'),100)"
              class="size-full"
            ></div>
          </div>
        </template>
        <% }) %>
      </section>
      <aside class="col-span-1 size-full" @click="incrementIndex(1)"></aside>
    </div>

    <div class="flex-col flex-1 w-full" @click="incrementIndex(1)"></div>
    <footer
      class="w-full motion"
      x-data="{hidden : true}"
      @mouseover=" hidden = false"
      @mouseleave="hidden=true"
    >
      <section
        class="size-full motion flex justify-center"
        x-bind:class="hidden ? 'translate-y-full' : ''"
      >
        <h4>Made in BesBar in order to BesBar</h4>
      </section>
    </footer>
    <script>
      function initPlayer(el, videoId) {
        var player;
        window.onYouTubeIframeAPIReady = function () {
          player = new YT.Player(el, {
            height: "390",
            width: "640",
            videoId,
            playerVars: {
              playsinline: 1,
              mute: 1,
              autoplay: 1,
            },
            events: {
              onReady: function (event) {
                window.videoPlayer = player;
              },
            },
          });
        };

        if (YT.Player) window.onYouTubeIframeAPIReady();
      }
    </script>
  </body>
</html>
